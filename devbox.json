{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.15.0/.schema/devbox.schema.json",
  "packages": [
    "go-task@latest",
    "act@latest",
    "gh@latest",
    "gum@latest",
    "yq-go@latest",
    "jq@latest",
    "kubectl@latest",
    "kubernetes-helm@latest",
    "kustomize@latest",
    "python312@latest",
    "poetry@latest",
    "nodejs_24@latest",
    "gnused@latest",
    "terraform@latest",
    "awscli@latest",
    "git@latest",
    "bash@latest",
    "starship@latest"
  ],
  "env": {
    "SECRET_KEY": "django-insecure-dev-key-for-local-devbox",
    "DB_NAME": "pmbok_db",
    "DB_USER": "pmbok_user",
    "DB_PASSWORD": "secretpassword123",
    "DB_HOST": "localhost",
    "DB_PORT": "5432",
    "DB_SSLMODE": "disable",
    "RUN_MIGRATIONS": "1",
    "RUN_SEED": "auto",
    "RUN_COLLECTSTATIC": "0",
    "VITE_API_URL": "http://localhost:8000/api",
    "CORS_ALLOWED_ORIGINS": "http://localhost:5173,http://127.0.0.1:5173",
    "CSRF_TRUSTED_ORIGINS": "http://localhost:5173,http://127.0.0.1:5173",
    "EXTRA_ALLOWED_HOSTS": "127.0.0.1,localhost",
    "DEVBOX_ENV_NAME": "ERD"
  },
  "shell": {
    "init_hook": [
      "# --- 0. Auto-update de .devtools (Forzado a lo Ãºltimo) ---",
      "sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)}\"; DEVTOOLS_PATH=\".devtools\";",
      "if [[ \"${DEVTOOLS_SKIP_UPDATE:-0}\" != \"1\" ]]; then",
      "  echo \"ðŸ”„ Buscando actualizaciones en $DEVTOOLS_PATH ...\";",
      "  if [ -d \"$root/$DEVTOOLS_PATH/.git\" ] || [ -f \"$root/$DEVTOOLS_PATH/.git\" ]; then",
      "    git -C \"$root/$DEVTOOLS_PATH\" fetch origin >/dev/null 2>&1 || true;",
      "    git -C \"$root/$DEVTOOLS_PATH\" checkout -B main origin/main >/dev/null 2>&1 || true;",
      "    git -C \"$root/$DEVTOOLS_PATH\" reset --hard origin/main >/dev/null 2>&1 || true;",
      "    echo \"âœ… $DEVTOOLS_PATH actualizado a la Ãºltima versiÃ³n (HEAD).\";",
      "  else",
      "    git -C \"$root\" submodule update --init --recursive \"$DEVTOOLS_PATH\" >/dev/null 2>&1 || true;",
      "  fi",
      "fi",
      "# --- 1. ConfiguraciÃ³n de Alias Git (Apuntando a bin/) ---",
      "git config alias.acp '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-acp.sh\" \"$@\"; }; f'",
      "git config alias.gp '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-gp.sh\" \"$@\"; }; f'",
      "git config alias.rp '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-rp.sh\" \"$@\"; }; f'",
      "git config alias.promote '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-promote.sh\" \"$@\"; }; f'",
      "git config alias.feature '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-feature.sh\" \"$@\"; }; f'",
      "git config alias.pr '!f(){ sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel)}\"; bash \"$root/.devtools/bin/git-pr.sh\" \"$@\"; }; f'",
      "# --- 2. The Gatekeeper: Setup Wizard (Apuntando a bin/) ---",
      "bash .devtools/bin/setup-wizard.sh",
      "# --- 3. Mensajes de Bienvenida ---",
      "echo 'ðŸš€ ERD Ecosystem Devbox Loaded!'",
      "echo 'âœ… Database credentials & SSL settings applied automatically.'",
      "echo 'ðŸ’¡ Try running: devbox run backend'",
      "# --- 4. Menu Simplificado ---",
      "if [[ -t 0 && -t 1 ]]; then DEVX_CHOICE=\"\"; if command -v gum >/dev/null 2>&1; then DEVX_CHOICE=\"$(gum choose --header \"Selecciona tu Rol:\" \"Admin\" \"Dev\" \"Ops\")\"; else echo \"Selecciona tu Rol:\"; select opt in \"Admin\" \"Dev\" \"Ops\"; do DEVX_CHOICE=\"$opt\"; break; done; fi; case \"$DEVX_CHOICE\" in \"Admin\") export DEVBOX_ENV_NAME=\"ERD\" ;; \"Dev\") export DEVBOX_ENV_NAME=\"PMBOK\" ;; \"Ops\") export DEVBOX_ENV_NAME=\"GITOPS\" ;; *) export DEVBOX_ENV_NAME=\"${DEVBOX_ENV_NAME:-DEVBOX}\" ;; esac; devx() { export DEVBOX_ENV_NAME=\"$1\"; }; fi",
      "# --- 5. Prompt: Starship ---",
      "if command -v starship >/dev/null 2>&1; then sp=\"$(git rev-parse --show-superproject-working-tree 2>/dev/null || true)\"; root=\"${sp:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)}\"; export STARSHIP_CONFIG=\"$root/.starship.toml\"; if [[ -n \"${ZSH_VERSION:-}\" ]]; then eval \"$(starship init zsh)\"; else eval \"$(starship init bash)\"; fi; else if [[ -n \"${ZSH_VERSION:-}\" ]]; then export PROMPT=\"(devbox ${DEVBOX_ENV_NAME}) ${PROMPT}\"; else export PS1=\"(devbox ${DEVBOX_ENV_NAME}) ${PS1}\"; fi; fi"
    ]
  },
  "scripts": {
    "backend": "cd apps/pmbok/backend && chmod +x entrypoint.sh && poetry run ./entrypoint.sh python manage.py runserver 0.0.0.0:8000",
    "frontend": "cd apps/pmbok/frontend && npm run dev",
    "setup-k8s": "./devops/scripts/setup-cluster.sh",
    "acp": "bash ./.devtools/bin/git-acp.sh",
    "gp": "bash ./.devtools/bin/git-gp.sh",
    "rp": "bash ./.devtools/bin/git-rp.sh",
    "promote": "bash ./.devtools/bin/git-promote.sh",
    "feature": "bash ./.devtools/bin/git-feature.sh"
  }
}